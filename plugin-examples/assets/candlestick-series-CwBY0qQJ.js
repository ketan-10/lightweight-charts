import{S as g,u as W,P as p,B as S,g as x}from"./index-DxQGhxyu.js";function k(c,t){if(c>=2.5&&c<=4)return Math.floor(3*t);const h=1-.2*Math.atan(Math.max(4,c)-4)/(Math.PI*.5),b=Math.floor(c*h*t),s=Math.floor(c*t),d=Math.min(b,s);return Math.max(Math.floor(t),d)}class R extends g{constructor(t,a){super(t,a,!1)}_convertToCoordinates(t,a,i){a.indexesToCoordinates(this._items,W(this._itemsVisibleRange)),t.barPricesToCoordinates(this._items,i,W(this._itemsVisibleRange))}_createDefaultItem(t,a,i){return{time:t,open:a.value[p.Open],high:a.value[p.High],low:a.value[p.Low],close:a.value[p.Close],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}}_fillRawPoints(){const t=this._series.barColorer();this._items=this._series.bars().rows().map(a=>this._createRawItem(a.index,a,t))}}class B extends S{constructor(){super(...arguments),this._data=null,this._barWidth=0}setData(t){this._data=t}_drawImpl(t){if(this._data===null||this._data.bars.length===0||this._data.visibleRange===null)return;const{horizontalPixelRatio:a}=t;this._barWidth=k(this._data.barSpacing,a),this._barWidth>=2&&Math.floor(a)%2!==this._barWidth%2&&this._barWidth--;const i=this._data.bars;this._data.wickVisible&&this._drawWicks(t,i,this._data.visibleRange),this._data.borderVisible&&this._drawBorder(t,i,this._data.visibleRange);const l=this._calculateBorderWidth(a);(!this._data.borderVisible||this._barWidth>l*2)&&this._drawCandles(t,i,this._data.visibleRange)}_drawWicks(t,a,i){if(this._data===null)return;const{context:l,horizontalPixelRatio:n,verticalPixelRatio:h}=t;let b="",s=Math.min(Math.floor(n),Math.floor(this._data.barSpacing*n));s=Math.max(Math.floor(n),Math.min(s,this._barWidth));const d=Math.floor(s*.5);let r=null;for(let o=i.from;o<i.to;o++){const e=a[o];e.barWickColor!==b&&(l.fillStyle=e.barWickColor,b=e.barWickColor);const f=Math.round(Math.min(e.openY,e.closeY)*h),u=Math.round(Math.max(e.openY,e.closeY)*h),_=Math.round(e.highY*h),M=Math.round(e.lowY*h);let m=Math.round(n*e.x)-d;const C=m+s-1;r!==null&&(m=Math.max(r+1,m),m=Math.min(m,C));const w=C-m+1;l.fillRect(m,_,w,f-_),l.fillRect(m,u+1,w,M-u),r=C}}_calculateBorderWidth(t){let a=Math.floor(1*t);this._barWidth<=2*a&&(a=Math.floor((this._barWidth-1)*.5));const i=Math.max(Math.floor(t),a);return this._barWidth<=i*2?Math.max(Math.floor(t),Math.floor(1*t)):i}_drawBorder(t,a,i){if(this._data===null)return;const{context:l,horizontalPixelRatio:n,verticalPixelRatio:h}=t;let b="";const s=this._calculateBorderWidth(n);let d=null;for(let r=i.from;r<i.to;r++){const o=a[r];o.barBorderColor!==b&&(l.fillStyle=o.barBorderColor,b=o.barBorderColor);let e=Math.round(o.x*n)-Math.floor(this._barWidth*.5);const f=e+this._barWidth-1,u=Math.round(Math.min(o.openY,o.closeY)*h),_=Math.round(Math.max(o.openY,o.closeY)*h);if(d!==null&&(e=Math.max(d+1,e),e=Math.min(e,f)),this._data.barSpacing*n>2*s)x(l,e,u,f-e+1,_-u+1,s);else{const M=f-e+1;l.fillRect(e,u,M,_-u+1)}d=f}}_drawCandles(t,a,i){if(this._data===null)return;const{context:l,horizontalPixelRatio:n,verticalPixelRatio:h}=t;let b="";const s=this._calculateBorderWidth(n);for(let d=i.from;d<i.to;d++){const r=a[d];let o=Math.round(Math.min(r.openY,r.closeY)*h),e=Math.round(Math.max(r.openY,r.closeY)*h),f=Math.round(r.x*n)-Math.floor(this._barWidth*.5),u=f+this._barWidth-1;if(r.barColor!==b){const _=r.barColor;l.fillStyle=_,b=_}this._data.borderVisible&&(f+=s,o+=s,u-=s,e-=s),!(o>e)&&l.fillRect(f,o,u-f+1,e-o+1)}}}class P extends R{constructor(){super(...arguments),this._renderer=new B}_createRawItem(t,a,i){return{...this._createDefaultItem(t,a,i),...i.barStyle(t)}}_prepareRendererData(){const t=this._series.options();this._renderer.setData({bars:this._items,barSpacing:this._model.timeScale().barSpacing(),wickVisible:t.wickVisible,borderVisible:t.borderVisible,visibleRange:this._itemsVisibleRange})}}const V={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Y=(c,t)=>new P(c,t),v=()=>({type:"Candlestick",isBuiltIn:!0,defaultOptions:V,createPaneView:Y}),D=v();export{D as c};
